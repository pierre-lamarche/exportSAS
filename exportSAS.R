exportSAS <- function(x, nameTab, nameFile, nameScript, folder = getwd(), separator = ",", 
                      labelVar = TRUE, labelVal = FALSE, endofline = NULL, encoding = "") {
  oldPath <- getwd()
  setwd(folder)
  
  # manage end-of-line character
  if (is.null(endofline)) {
    if (.Platform$OS.type == "windows") endofline <- "CRLF" else
      if (.Platform$OS.type == "unix") endofline <- "LF"
  } else if (!endofline %in% c("CRLF","LF","CR"))
    stop("End-of-line parameter mispecified. Must be equal to CRLF, CR or LF.")
  
  write.table(x, file = nameFile, quote = FALSE, sep = separator, row.names = FALSE, 
              fileEncoding = encoding, na = "")
  
  # input list
  inputType <- sapply(x, class)
  if (!is.vector(inputType))
    inputType <- inputType[nrow(inputType),]
  inputT <- ifelse(inputType == "character", " $", "")
  inputList <- paste0(paste0(names(x), inputT), collapse = " \n ")
  
  # dealing with the length of character variables
  varChar <- names(x)[inputType == "character"]
  maxLength <- function(x) return(apply(sapply(x,nchar), 2, max, na.rm = TRUE))
  length <- maxLength(x[,varChar])
  lengthList <- paste0(paste0(varChar, inputT[inputType == "character"], length, "."), 
                       collapse = "\n ")
  
  addCode <- function(...) paste0(code, ...)
  code <- "/* Codes generated by function exportSAS \n "
  code <- addCode("LIBNAME out \"", folder, "\" ; \n ")
  code <- addCode("\n ")
  code <- addCode("DATA out.", nameTab, " ; \n ")
  code <- addCode("INFILE \"", folder, "/", nameFile, "\" DSD DLM = \"", separator, 
                  "\" TERMSTR = ", endofline," ; \n ")
  code <- addCode("LENGTH \n ", lengthList, "\n ; \n ")
  code <- addCode("INPUT \n ")
  code <- addCode(inputList, " \n ; \n ")
  code <- addCode("RUN ; \n ")
  
  write.table(code, file = nameScript, quote = FALSE, sep = "", row.names = FALSE, 
              col.names = FALSE, fileEncoding = encoding)
}